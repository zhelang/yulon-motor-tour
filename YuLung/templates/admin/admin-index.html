{% extends 'admin/admin-base.html' %}

{% block title %}首頁{% endblock %}

{% block meta%}
{% endblock %}

{% block extraheader%}
{% endblock%}

{% block body %}
<div class="row">
    {% include 'admin/order/index_calendar.html' %}
    <div class="col pt-2">
        <ul class="nav nav-tabs col" role="tablist">
            <li class="nav-item">
                <a class="nav-link active text-danger" data-toggle="tab" href="#aweek">一周內</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-secondary" data-toggle="tab" href="#unreturn">未回報</a>
            </li>
            <!--
            <li class="nav-item">
                <a class="nav-link text-secondary" data-toggle="tab" href="#return">已回報</a>
            </li>-->
        </ul>
        <!-- Tab panes -->
        <div class="tab-content">
            {% include 'admin/index/assigned_aweek.html'%}
            {% include 'admin/index/assigned_unreturn.html'%}
            <!--{% include 'admin/order/assigned_return.html'%}-->
        </div>
        <!-- End of tab panes -->
</div>

<!--以下是原程式，顯示這個帳號被指派的行程活動-->
<!--<div class="row">
    <div class="col-12">
        <div class="card row my-3">
            <div class="card-header">
                <h4 class="card-title"><i class="fa fa-table"></i> 行程表</h4>
            </div>
            <div class="card-body">
                <div class="card">
                    <div class="card-block">本日預約導覽：0</div>
                </div>
                <div class="card">
                    <div class="card-block">本月預約導覽：0（未執行）/ 10（已執行）</div>
                </div>
                <div id="calendar">
                </div>
            </div>
        </div>
    </div>
</div>-->

<script>
    $(document).ready(function() {
        var date = new Date();
        var m = date.getMonth();
        var y = date.getFullYear();

        $('#calendar').fullCalendar({
            header: {
                right: '',
                center: '',
                left: ''
            },
            buttonIcons: {
                prev: 'calendar__prev',
                next: 'calendar__next'
            },
            theme: false,
            selectable: true,
            selectHelper: true,
            editable: true,
            events: [
                {
                    id: 1,
                    title: '10:00｜1-1 \n課程管理',
                    start: new Date(y, m, 1),
                    allDay: true,
                    description: '日期｜2018-1-1 10:00\n課程代碼｜SYACDFU\n客群名稱｜合作機關項目\n客戶姓名｜辛普森\n連絡電話｜0954871364\n人數｜8'
                },
                {
                    id: 2,
                    title: '14:00｜1-1 \n工廠管理',
                    start: new Date(y, m, 1),
                    allDay: true,
                    description: '日期｜2018-1-1 10:00\n課程代碼｜SYACDFU\n客群名稱｜合作機關項目\n客戶姓名｜辛普森\n連絡電話｜0954871364\n人數｜8'
                },
            ],

            /*viewRender: function (view) {
                var calendarDate = $('#calendar').fullCalendar('getDate');
                var calendarMonth = calendarDate.month();

                //Set data attribute for header. This is used to switch header images using css
                $('#calendar .fc-toolbar').attr('data-calendar-month', calendarMonth);

                //Set title in page header
                $('.content__title--calendar > h1').html(view.title);
            },
            */

            eventClick: function (event, element) {
                $('#edit-event').modal('show');
                $('.edit-event__id').val(event.id);
                $('.edit-event__title').val(event.title);
                $('.edit-event__description').val(event.description);
            }
        });

        //Update/Delete an Event (non-Delete)
        $('body').on('click', '[data-calendar]', function(){
            var calendarAction = $(this).data('calendar');
            var currentId = $('.edit-event__id').val();
            var currentTitle = $('.edit-event__title').val();
            var currentDesc = $('.edit-event__description').val();
            var currentEvent = $('#calendar').fullCalendar('clientEvents', currentId);
            //Update
            if(calendarAction === 'update') {
                if (currentTitle != '') {
                    currentEvent[0].title = currentTitle;
                    currentEvent[0].description = currentDesc;

                    $('#calendar').fullCalendar('updateEvent', currentEvent[0]);
                    $('#edit-event').modal('hide');
                }
                else {
                    $('.edit-event__title').closest('.form-group').addClass('has-error');
                    $('.edit-event__title').focus();
                }
            }
        });
        //Calendar views switch
        $('body').on('click', '[data-calendar-view]', function(e){
            e.preventDefault();
            $('[data-calendar-view]').removeClass('actions__item--active');
            $(this).addClass('actions__item--active');
            var calendarView = $(this).attr('data-calendar-view');
            $('#calendar').fullCalendar('changeView', calendarView);
        });
        //Calendar Next
        $('body').on('click', '.actions__calender-next', function (e) {
            e.preventDefault();
            $('#calendar').fullCalendar('next');
        });
        //Calendar Prev
        $('body').on('click', '.actions__calender-prev', function (e) {
            e.preventDefault();
            $('#calendar').fullCalendar('prev');
        });
    });  
</script>
{% endblock %}
